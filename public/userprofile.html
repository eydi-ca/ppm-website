<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Profile | ProfilePic Multimedia</title>

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="nav.css">

  <style>
    /* ============================ */
    /* VARIABLES (From your reference) */
    /* ============================ */
    :root {
      --main-header-font: 'Playfair Display', serif;
      --section-font: 'DM Sans', sans-serif;
      --body-font: 'Inter', sans-serif;
      
      /* Colors */
      --bgwhite: #FAFAFA;
      --text-color: #0A142D; /* Navy */
      --brand-color: #f4981e; /* Light Orange */
      --dark-color: #ce6826;  /* Dark Orange Accent */
      --light-color: #f9bf5f;
      --grey-light: #e0e0e0;
    }

    /* ============================ */
    /* GLOBAL RESET */
    /* ============================ */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background-color: var(--bgwhite);
      color: var(--text-color);
      font-family: var(--body-font);
      line-height: 1.6;
    }


    /* ============================ */
    /* PROFILE HERO SECTION         */
    /* ============================ */
    .profile-hero {
        background: linear-gradient(rgba(10, 20, 45, 0.8), rgba(10, 20, 45, 0.9));
        color: white;
        padding: 40px 5% 80px;
        display: flex;
        align-items: center;
        gap: 30px;
    }

    .profile-avatar {
        margin-top: 80px;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 4px solid var(--brand-color);
        object-fit: cover;
    }

    .profile-info h1 {
        margin-top: 80px;
        font-family: var(--main-header-font);
        font-size: 32px;
        margin-bottom: 5px;
    }

    .profile-info p {
        font-family: var(--section-font);
        color: #ccc;
        font-size: 16px;
    }

    .edit-badge {
        background: var(--dark-color);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 12px;
        font-family: var(--section-font);
        cursor: pointer;
        margin-top: 10px;
        display: inline-block;
    }

    /* ============================ */
    /* TAB NAVIGATION               */
    /* ============================ */
    .profile-tabs-container {
        background: white;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .profile-tabs {
        display: flex;
        justify-content: center;
        gap: 40px;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }

    .tab-btn {
        padding: 20px 5px;
        background: none;
        border: none;
        font-family: var(--section-font);
        font-weight: 700;
        font-size: 16px;
        color: #888;
        cursor: pointer;
        position: relative;
        transition: 0.3s;
    }

    .tab-btn:hover { color: var(--dark-color); }
    
    .tab-btn.active { color: var(--text-color); }
    
    .tab-btn.active::after {
        content: '';
        position: absolute;
        bottom: 0; left: 0; width: 100%;
        height: 3px;
        background-color: var(--dark-color);
    }

    /* ============================ */
    /* MAIN CONTENT AREA            */
    /* ============================ */
    .profile-content {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 20px;
        min-height: 50vh;
    }

    /* --- TAB LOGIC CSS --- */
    .tab-content {
        display: none; /* Hides all tabs by default */
        animation: fadeIn 0.4s ease-in-out;
    }

    .tab-content.active {
        display: block; /* Shows only the active tab */
    }

    /* Simple fade animation for smooth switching */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* CARDS & FORMS */
    .content-card {
        background: white;
        padding: 40px;
        border-radius: 8px;
        border: 1px solid #eee;
        box-shadow: 0 5px 20px rgba(0,0,0,0.02);
    }

    .section-title {
        font-family: var(--main-header-font);
        color: var(--text-color);
        font-size: 28px;
        margin-bottom: 25px;
        border-bottom: 2px solid var(--brand-color);
        display: inline-block;
        padding-bottom: 5px;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }

    .form-group { margin-bottom: 20px; }
    
    .form-group label {
        display: block;
        font-family: var(--section-font);
        font-weight: 700;
        font-size: 14px;
        margin-bottom: 8px;
        color: #555;
    }

    .form-group input {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-family: var(--body-font);
        font-size: 16px;
    }

    .btn-primary {
        background-color: var(--text-color);
        color: white;
        padding: 12px 30px;
        border: none;
        font-family: var(--section-font);
        font-weight: 700;
        cursor: pointer;
        border-radius: 4px;
        transition: 0.3s;
    }

    .btn-primary:hover { background-color: var(--dark-color); }

    /* GALLERY GRID */
    .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
    }

    .gallery-item {
        height: 250px;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        cursor: pointer;
    }

    .gallery-item img {
        width: 100%; height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }

    .gallery-item:hover img { transform: scale(1.05); }

    .gallery-actions {
        position: absolute;
        bottom: 0; left: 0; width: 100%;
        background: rgba(10, 20, 45, 0.8);
        color: white;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 14px;
    }

    /* TABLES (Transactions/Bookings) */
    .custom-table {
        width: 100%;
        border-collapse: collapse;
        font-family: var(--body-font);
    }

    .custom-table th {
        text-align: left;
        padding: 15px;
        background-color: #f8f8f8;
        color: var(--text-color);
        font-family: var(--section-font);
        font-weight: 700;
    }

    .custom-table td {
        padding: 15px;
        border-bottom: 1px solid #eee;
        color: #555;
    }

    .status-badge {
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
    }
    
    .status-completed { background: #e8f5e9; color: #2e7d32; }
    .status-pending { background: #fff3e0; color: #ef6c00; }
    .status-cancelled { background: #ffebee; color: #c62828; }

    /* RESPONSIVE */
    @media (max-width: 768px) {
        .profile-hero { flex-direction: column; text-align: center; }
        .form-grid { grid-template-columns: 1fr; }
        .profile-tabs { gap: 20px; font-size: 14px; overflow-x: auto; justify-content: flex-start; }
        .tab-btn { white-space: nowrap; }
        .nav-links { display: none; } /* Standard Mobile nav behavior assumed */
    }

    /*=================================*/
    /* The Grid Container */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); /* Responsive columns */
            gap: 25px; /* Space between cards */
            margin-top: 20px;
        }

        /* The Card shell */
        .card {
            background: white;
            border-radius: 12px;
            overflow: hidden; /* Keeps image corners rounded */
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        /* The Image Container - Forces the Height */
        .img-container {
            width: 100%;
            height: 220px; /* FIXED HEIGHT: This makes them all the same size */
            background-color: #f0f0f0; /* Grey background while loading */
            position: relative;
        }

        /* The Image itself - The "Cover" magic */
        .img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Crops image to fill the box perfectly */
            object-position: center;
            display: block;
        }

        /* Card Text Area */
        .card-body {
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-grow: 1; /* Pushes button to bottom if text varies */
        }

        .card-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-color);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-text {
            font-size: 13px;
            color: #888;
            margin: 0;
        }

        /* Download Button Styling */
        .download-btn {
            margin-top: auto; /* Pushes button to bottom */
            width: 100%;
            padding: 10px;
            background-color: var(--text-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: 0.2s;
        }

        .download-btn:hover {
            background-color: var(--dark-color);
        }

        /*=================================*/
        /* --- LARGE IMAGE MODAL (Preview) --- */
        .modal {
            display: none; 
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .modal-content {
            max-width: 80%;
            max-height: 80vh;
            border-radius: 5px;
            animation: zoom 0.3s;
        }

        .close {
            position: absolute;
            top: 20px; right: 30px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
        }

        #caption {
            color: #ccc;
            margin-top: 10px;
            text-align: center;
        }

        /* --- SMALL STATUS MODAL (Download Alerts) --- */
        .modal-small {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 2000; /* Higher than image modal */
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5); /* Dim background */
            justify-content: center;
            align-items: center;
        }

        .modal-content-small {
            position: relative;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: slideDown 0.3s;
        }

        .close-small {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 24px;
            color: #999;
            cursor: pointer;
        }

        /* Update this specific ID in your CSS */
        #statusMessage {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
            
            /* ADD THESE LINES TO FIX OVERFLOW: */
            word-wrap: break-word;       /* Legacy support */
            overflow-wrap: break-word;   /* Standard */
            word-break: break-word;      /* Forces long filenames to wrap */
            max-width: 100%;             /* Ensures it doesn't exceed the modal width */
        }

        @keyframes zoom { from {transform:scale(0)} to {transform:scale(1)} }
        @keyframes slideDown { from {transform:translateY(-20px); opacity:0;} to {transform:translateY(0); opacity:1;} }
        

        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top of everything */
            padding-top: 50px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
        }

        /* Modal Content (image) */
        .modal-content {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 900px;
            max-height: 80vh; /* Ensure it doesn't go taller than screen */
            object-fit: contain; /* Ensure the whole image is visible */
            border-radius: 5px;
            animation-name: zoom;
            animation-duration: 0.2s;
        }

        /* Caption of Modal Image */
        #caption {
            margin: auto;
            display: block;
            width: 80%;
            max-width: 700px;
            text-align: center;
            color: #ccc;
            padding: 10px 0;
            height: 50px;
            font-family: var(--section-font);
        }

        /* Add Animation */
        @keyframes zoom {
            from {transform:scale(0)} 
            to {transform:scale(1)}
        }

        /* The Close Button */
        .close {
            position: absolute;
            top: 15px;
            right: 35px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            transition: 0.3s;
            z-index: 1001;
        }

        .close:hover,
        .close:focus {
            color: #bbb;
            text-decoration: none;
            cursor: pointer;
        }

        /* 100% Image Width on Smaller Screens */
        @media only screen and (max-width: 700px){
            .modal-content {
                width: 100%;
            }
        }


        /* --- CTA BAR STYLES --- */
        .cta-bar {
            width: 100%;
            /* Push it down 70px because your Navbar is fixed height: 70px */
            margin-top: 70px; 
            background-color: #fff3cd; /* Yellow Background */
            border-bottom: 1px solid #ffeeba;
            color: #856404;
            padding: 15px 20px;
            box-sizing: border-box;
            /* Ensure it sits below navbar but above content */
            position: relative; 
            z-index: 900; 
        }

        .cta-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: center; /* Center everything */
            align-items: center;
            gap: 30px; /* Space between text and button */
            flex-wrap: wrap; /* Allow stacking on mobile */
        }

        .cta-text {
            text-align: center;
        }

        .cta-text h3 {
            margin: 0;
            font-size: 1.1rem;
            display: inline-block;
            margin-right: 10px;
            color: #856404;
        }

        .cta-text p {
            margin: 0;
            display: inline-block;
            font-size: 1rem;
        }

        .cta-btn {
            background-color: #e67e22;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 50px; /* Pill shape button */
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s;
            box-shadow: 0 4px 6px rgba(230, 126, 34, 0.2);
        }

        .cta-btn:hover {
            background-color: #d35400;
            transform: translateY(-2px);
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .cta-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .cta-text h3 {
                display: block; /* Stack title on mobile */
                margin-bottom: 5px;
            }
        }

        .main-content-wrapper {
        /* If banner is hidden, this padding saves us. 
        If banner is shown, this padding just adds a little space below banner. */
        /*padding-top: 90px; */
        }
    </style>
</head>
<body>

  <!-- ===== NAVBAR ===== -->
  <header class="navbar">
    <div class="nav-container">
      <div class="logo">
        <!-- Replace this with your actual logo image -->
        <img src="/public/materials/logos/logo3.png" alt="Profilepic Multimedia Logo" />
      </div>

      <nav class="nav-links">
        <a href="index.html" class="active">Home</a>
        <a href="about.html">About Us</a>
        <a href="package.html">Package & Booking</a>
        <!--
        <div class="dropdown">
          <button class="dropbtn">Services â–¾</button> 
          <div class="dropdown-content">
            <a href="service_and_packages.html">Photography Packages</a>
            <a href="#locations-section">Locations</a>
            <a href="#how-it-works">Booking Guide</a>
          </div>
        </div>-->

        <a href="gallery.html">Gallery</a>
        <a href="contact.html">Contact</a>
        
        <div class="account-icon" id="account-nav">
          <!-- This will be updated by JS -->
        </div>
      </nav>
    </div>
  </header>

  
    <div id="purchaseBanner" class="cta-bar" style="display:none;">
        <div class="cta-content">
            <div class="cta-text">
                <h3><i class="fa-solid fa-lock-open"></i> Unlock Full Gallery</h3>
                <p>Get high-resolution downloads of all photos for <b>â‚±350.00</b> <small>(Expires in 30 days)</small></p>
            </div>
            <button id="buyNowBtn" class="cta-btn">
                Pay via GCash / Card <i class="fa-solid fa-arrow-right"></i>
            </button>
        </div>
    </div>

  <section class="profile-hero">
    <img src="https://i.pravatar.cc/300?img=10" alt="User Profile" class="profile-avatar">
    <div class="profile-info">
        <h1 id="profileWelcome">Hello, Loading...</h1>
        <p>Member since 2024 | Traveler & Explorer</p>
        <div class="edit-badge">
            <i class="fa-solid fa-pen"></i> Edit Avatar
        </div>
    </div>
  </section>

  <div class="profile-tabs-container">
      <div class="profile-tabs">
          <button class="tab-btn active" onclick="openTab(event, 'gallery')">My Gallery</button>
          <button class="tab-btn" onclick="openTab(event, 'account')">Profile Details</button>
          <button class="tab-btn" onclick="openTab(event, 'bookings')">My Bookings</button>
          <button class="tab-btn" onclick="openTab(event, 'transactions')">Transactions</button>
          <button class="tab-btn" onclick="openTab(event, 'security')">Security</button>
      </div>
  </div>

  <div class="profile-content">

    <div id="imageModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="modalImg">
        <div id="caption"></div>
    </div>

    <div id="statusModal" class="modal-small">
        <div class="modal-content-small">
            <span class="close-small" id="closeStatusX">&times;</span>
            
            <div id="statusIcon" style="font-size: 40px; margin-bottom: 15px;"></div>
            
            <h3 id="statusTitle" style="margin-bottom: 10px; color: var(--text-color);"></h3>
            <p id="statusMessage" style="color: #666; font-size: 14px; margin-bottom: 20px;"></p>
            
            <button id="statusCloseBtn" class="btn-primary" style="padding: 8px 25px;">Close</button>
        </div>
    </div>

    <div id="confirmModal" class="modal" style="display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center;">
        <div class="modal-content-small" style="background: #fff; padding: 30px; border-radius: 12px; width: 90%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative;">
            
            <h3 style="margin-top: 0; color: #333;">Confirm Unlock</h3>
            <p id="confirmMessage" style="color: #666; margin: 15px 0;">Spend 1 Credit to unlock this photo?</p>
            
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button id="confirmNoBtn" style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background: #e0e0e0; color: #333; font-weight: bold;">Cancel</button>
                <button id="confirmYesBtn" style="padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background: #3498db; color: white; font-weight: bold;">Yes, Unlock</button>
            </div>

        </div>
    </div>

      <div id="gallery" class="tab-content active main-content-wrapper">
       <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
    
        <h2 class="section-title" style="margin: 0;">Your Travel Memories</h2>

        <div style="display: flex; align-items: center; gap: 10px;">
            
            <div id="creditDisplay" style="background: #f0f2f5; color: #555; padding: 8px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; border: 1px solid #ddd;">
                Credits: <span id="creditCount">0</span>
            </div>

            <button onclick="window.location.href='package.html'" style="background-color: #f39c12; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                <i class="fa-solid fa-store"></i> Buy Packages
            </button>

            <button id="downloadAllBtn" style="display:none; background-color: #27ae60; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; gap: 5px;">
                <i class="fa-solid fa-cloud-arrow-down"></i> Download All
            </button>
        </div>
    </div>
          
          <div class="gallery-container">
              <div id="loading" style="text-align:center; padding: 20px;">
                  <i class="fa-solid fa-spinner fa-spin" style="font-size: 24px;"></i> 
                  <p>Loading your photos...</p>
              </div>
              
              <div class="grid" id="galleryGrid"></div>
          </div>

           <script>
            // ---------------------------------------------------------
            // 0. AUTH & GLOBAL SETUP
            // ---------------------------------------------------------
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
            }

            // ---------------------------------------------------------
            // 1. DOM ELEMENTS & MODALS
            // ---------------------------------------------------------
            // Image Preview Modal
            const imageModal = document.getElementById("imageModal");
            const modalImg = document.getElementById("modalImg");
            const captionText = document.getElementById("caption");
            const imageModalClose = document.querySelector(".close"); 

            // Status/Alert Modal
            const statusModal = document.getElementById("statusModal");
            const statusTitle = document.getElementById("statusTitle");
            const statusMessage = document.getElementById("statusMessage");
            const statusIcon = document.getElementById("statusIcon");
            const statusCloseBtn = document.getElementById("statusCloseBtn");
            const statusCloseX = document.getElementById("closeStatusX");

            // Confirmation Modal (NEW)
            const confirmModal = document.getElementById("confirmModal");
            const confirmMessage = document.getElementById("confirmMessage");
            const confirmYesBtn = document.getElementById("confirmYesBtn");
            const confirmNoBtn = document.getElementById("confirmNoBtn");
            let pendingFileToUnlock = null; // Stores ID while waiting for "Yes"

            // Profile Inputs
            const firstNameInput = document.getElementById('firstNameInput');
            const lastNameInput = document.getElementById('lastNameInput');
            const emailInput = document.getElementById('emailInput');
            const phoneInput = document.getElementById('phoneInput');
            const saveProfileBtn = document.getElementById('saveProfileBtn');


            // ---------------------------------------------------------
            // 2. HELPER FUNCTIONS
            // ---------------------------------------------------------
            
            // Show Status Modal
            function showStatusModal(title, message, isSuccess = false, isError = false, redirectUrl = null, buttonText = "Close") {
                statusTitle.innerText = title;
                statusMessage.innerText = message;
                
                statusIcon.innerHTML = '';
                if (isSuccess) {
                    statusIcon.innerHTML = '<i class="fa-solid fa-circle-check"></i>'; 
                    statusIcon.style.color = '#27ae60'; 
                } else if (isError) {
                    statusIcon.innerHTML = '<i class="fa-solid fa-circle-xmark"></i>'; 
                    statusIcon.style.color = '#e74c3c'; 
                } else {
                    statusIcon.innerHTML = '<i class="fa-solid fa-lock"></i>'; 
                    statusIcon.style.color = '#f39c12'; 
                }

                if (redirectUrl) {
                    statusCloseBtn.innerText = buttonText;
                    statusCloseBtn.onclick = function() { window.location.href = redirectUrl; };
                } else {
                    statusCloseBtn.innerText = "Close";
                    statusCloseBtn.onclick = closeStatusModal;
                }
                
                statusModal.style.display = 'flex';
            }

            // Close Logic
            function closeStatusModal() { statusModal.style.display = 'none'; }
            if(statusCloseBtn) statusCloseBtn.onclick = closeStatusModal;
            if(statusCloseX) statusCloseX.onclick = closeStatusModal;
            if(imageModalClose) imageModalClose.onclick = function() { imageModal.style.display = "none"; }
            
            // Confirmation Modal Logic
            if(confirmNoBtn) {
                confirmNoBtn.onclick = function() {
                    confirmModal.style.display = 'none';
                    pendingFileToUnlock = null;
                };
            }
            if(confirmYesBtn) {
                confirmYesBtn.onclick = async function() {
                    confirmModal.style.display = 'none';
                    if (pendingFileToUnlock) {
                        await processUnlock(pendingFileToUnlock);
                    }
                };
            }

            // Window Click (Close modals if clicking outside)
            window.onclick = function(event) {
                if (event.target == imageModal) imageModal.style.display = "none";
                if (event.target == statusModal) statusModal.style.display = "none";
                if (event.target == confirmModal) confirmModal.style.display = "none";
            }


            // ---------------------------------------------------------
            // 3. PROFILE LOGIC
            // ---------------------------------------------------------
            async function loadUserProfile() {
                if (token) {
                    try {
                        const base64Url = token.split('.')[1];
                        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                        const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
                        const payload = JSON.parse(jsonPayload);
                        if (payload.email) emailInput.value = payload.email;
                    } catch (e) { console.log("Token error", e); }
                }

                try {
                    const response = await fetch('/api/user/profile', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (!response.ok) throw new Error('Failed to load profile');
                    const user = await response.json();

                    firstNameInput.value = user.first_name || ""; 
                    lastNameInput.value = user.last_name || "";
                    phoneInput.value = user.phone_number || ""; 
                    if(user.email) emailInput.value = user.email;

                    // ===============================================
                    // 2. PASTE THIS PART HERE TO FIX THE "LOADING"
                    // ===============================================
                    const welcomeText = document.getElementById('profileWelcome');
                    if (welcomeText) {
                        // We use || to handle empty names
                        const fName = userData.firstName || 'User';
                        const lName = userData.lastName || '';
                        welcomeText.innerText = `Hello, ${fName} ${lName}`;
                    }
                    // ===============================================
                } catch (error) { console.error(error); }
            }

            async function saveUserProfile() {
                const updatedData = {
                    first_name: firstNameInput.value,
                    last_name: lastNameInput.value,
                    phone_number: phoneInput.value
                };
                showStatusModal("Saving...", "Updating profile.", false);

                try {
                    const response = await fetch('/api/user/profile', {
                        method: 'PUT',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}` 
                        },
                        body: JSON.stringify(updatedData)
                    });

                    if (response.ok) showStatusModal("Success!", "Profile updated.", true);
                    else throw new Error("Update failed");
                } catch (error) {
                    showStatusModal("Update Failed", "Please try again.", false, true);
                }
            }
            if(saveProfileBtn) saveProfileBtn.addEventListener('click', saveUserProfile);


            // ---------------------------------------------------------
            // 4. GALLERY LOGIC (Corrected & Integrated)
            // ---------------------------------------------------------
            async function loadGallery() {
                console.log("ðŸ”„ Loading Gallery...");
                try {
                    // A. Check Status & Credits
                    const statusRes = await fetch('/api/auth/me', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    
                    let isFullUnlocked = false;
                    let credits = 0;

                    if (statusRes.ok) {
                        const userProfile = await statusRes.json();
                        isFullUnlocked = userProfile.is_full_unlocked === 1;
                        credits = parseInt(userProfile.credits) || 0;
                    }

                    // B. Update UI Header
                    const purchaseBanner = document.getElementById('purchaseBanner');
                    const creditCountSpan = document.getElementById('creditCount');
                    const creditDisplay = document.getElementById('creditDisplay');
                    const downloadAllBtn = document.getElementById('downloadAllBtn');

                    // Credit UI
                    if (isFullUnlocked) {
                        if(creditCountSpan) creditCountSpan.innerText = "âˆž"; 
                        if(creditDisplay) {
                            creditDisplay.style.background = "#d4edda"; 
                            creditDisplay.style.color = "#155724";
                        }
                        if(purchaseBanner) purchaseBanner.style.display = 'none';
                        document.body.style.paddingTop = "90px"; 
                    } else {
                        if(creditCountSpan) creditCountSpan.innerText = credits;
                        if(creditDisplay) {
                            creditDisplay.style.background = "#f0f2f5";
                            creditDisplay.style.color = "#555";
                        }
                        if(purchaseBanner) purchaseBanner.style.display = 'block';
                        document.body.style.paddingTop = "0px";
                    }

                    // Download All Button
                    if (downloadAllBtn) {
                        if (isFullUnlocked) {
                            downloadAllBtn.style.display = 'flex';
                            downloadAllBtn.onclick = async function() {
                                const originalText = downloadAllBtn.innerHTML;
                                downloadAllBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Zipping...';
                                downloadAllBtn.disabled = true;
                                try {
                                    const response = await fetch('/api/user/gallery/download-all', {
                                        headers: { 'Authorization': `Bearer ${token}` }
                                    });
                                    if (response.ok) {
                                        const blob = await response.blob();
                                        const url = window.URL.createObjectURL(blob);
                                                                                                                                                                                               const a = document.createElement('a');
                                        a.href = url;
                                        a.download = "Travel_Memories.zip";
                                        document.body.appendChild(a);
                                        a.click();
                                        window.URL.revokeObjectURL(url);
                                        showStatusModal("Download Started", "Zip file downloading.", true);
                                    } else {
                                        throw new Error("Download failed");
                                    }
                                } catch (error) {
                                    console.error(error);
                                    alert("Error downloading zip.");
                                } finally {
                                    downloadAllBtn.innerHTML = originalText;
                                    downloadAllBtn.disabled = false;
                                }
                            };
                        } else {
                            downloadAllBtn.style.display = 'none';
                        }
                    }

                    // C. Fetch & Render Photos
                    const response = await fetch('/api/user/gallery', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    if (!response.ok) throw new Error('Failed to load gallery');

                    const files = await response.json();
                    const grid = document.getElementById('galleryGrid');
                    const loading = document.getElementById('loading');
                    if(loading) loading.style.display = 'none';

                    if (files.length === 0) {
                        grid.innerHTML = '<p style="grid-column: 1/-1; text-align:center;">No photos found.</p>';
                        return;
                    }

                    grid.innerHTML = ''; // Clear existing

                    files.forEach((file) => {
                        const card = document.createElement('div');
                        card.className = 'card';

                        const img = document.createElement('img');
                        img.alt = file.package_frame || "Travel Photo";
                        img.style.cursor = "pointer"; 
                        
                        fetch(`/api/user/image/${file.drive_file_id}?mode=preview`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        })
                        .then(res => res.blob())
                        .then(blob => {
                            img.src = URL.createObjectURL(blob);
                            img.onclick = function(){
                                imageModal.style.display = "block";
                                modalImg.src = this.src;
                                if(captionText) captionText.innerHTML = file.package_frame || "";
                            }
                        })
                        .catch(err => console.error("Preview load failed", err));
                        
                        const imgContainer = document.createElement('div');
                        imgContainer.className = 'img-container';
                        imgContainer.appendChild(img);

                        // --- BUTTON LOGIC ---
                        let buttonHtml = '';

                        // 1. GREEN: Full Access or Already Unlocked
                        if (isFullUnlocked || file.is_unlocked_single === 1) {
                            buttonHtml = `
                                <button class="download-btn" onclick="downloadImage('${file.drive_file_id}', '${file.filename}')" style="background-color: #27ae60;">
                                    <i class="fa-solid fa-download"></i> Download Original
                                </button>`;
                        } 
                        // 2. BLUE: Locked but Has Credits -> Open Confirm Modal
                        else if (credits > 0) {
                            buttonHtml = `
                                <button class="download-btn" onclick="askToUnlock('${file.drive_file_id}')" style="background-color: #3498db;">
                                    <i class="fa-solid fa-ticket"></i> Unlock (1 Credit)
                                </button>`;
                        } 
                        // 3. GREY: No Access -> Redirect to Package
                        else {
                            buttonHtml = `
                                <button class="download-btn" 
                                    onclick="showStatusModal('Gallery Locked', 'You need to purchase a package to download photos.', false, false, 'package.html', 'View Packages')" 
                                    style="background-color: #95a5a6; cursor: pointer;">
                                    <i class="fa-solid fa-lock"></i> Unlock Photo
                                </button>`;
                        }

                        const cardBody = document.createElement('div');
                        cardBody.className = 'card-body';
                        cardBody.innerHTML = `
                            <h3 class="card-title">${file.package_frame || 'Photo'}</h3>
                            <p class="card-text">${new Date(file.upload_date).toLocaleDateString()}</p>
                            ${buttonHtml} 
                        `;

                        card.appendChild(imgContainer);
                        card.appendChild(cardBody);
                        grid.appendChild(card);
                    });

                } catch (error) {
                    console.error(error);
                    const loading = document.getElementById('loading');
                    if(loading) loading.innerHTML = '<p style="color:red">Error loading gallery.</p>';
                }
            }

            // --- HELPER: UNLOCK SINGLE (With Modal) ---
            function askToUnlock(fileId) {
                pendingFileToUnlock = fileId;
                confirmMessage.innerText = "Spend 1 Credit to unlock this photo?";
                confirmModal.style.display = 'flex';
            }

            async function processUnlock(fileId) {
                showStatusModal("Unlocking...", "Processing credit.", false);

                try {
                    const res = await fetch('/api/user/unlock-single', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}` 
                        },
                        body: JSON.stringify({ fileId: fileId })
                    });
                    const data = await res.json();

                    if (res.ok && data.success) {
                        showStatusModal("Success! ðŸ”“", "Photo unlocked.", true);
                        setTimeout(() => loadGallery(), 1500);
                    } else {
                        showStatusModal("Error", data.message || "Could not unlock.", false, true);
                    }
                } catch (err) {
                    console.error(err);
                    showStatusModal("Error", "Network error.", false, true);
                }
            }

            // --- HELPER: DOWNLOAD SINGLE ---
            async function downloadImage(fileId, filename) {
                try {
                    showStatusModal("Preparing Download...", "Please wait.", false);
                    const response = await fetch(`/api/user/image/${fileId}?mode=download`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.style.display = 'none';
                        a.href = url;
                        a.download = filename; 
                        document.body.appendChild(a);
                        a.click();
                        window.URL.revokeObjectURL(url);
                        showStatusModal("Download Started", "Your photo is downloading.", true);
                    } else {
                        showStatusModal("Access Denied", "Permission denied.", false, true);
                    }
                } catch (err) {
                    console.error(err);
                    showStatusModal("Error", "Network error.", false, true);
                }
            }


            // ---------------------------------------------------------
            // 5. PAYMENT LOGIC
            // ---------------------------------------------------------
            const buyNowBtn = document.getElementById('buyNowBtn');
            if (buyNowBtn) {
                buyNowBtn.addEventListener('click', async () => {
                    buyNowBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Generating Link...';
                    buyNowBtn.disabled = true;
                    try {
                        // ðŸ‘‡ UPDATED FETCH CALL
                        const res = await fetch('/api/payment/create-checkout-session', {
                            method: 'POST',
                            headers: { 
                                'Content-Type': 'application/json', // ðŸ‘ˆ REQUIRED NOW
                                'Authorization': `Bearer ${token}` 
                            },
                            // ðŸ‘‡ WE MUST SPECIFY THE PACKAGE
                            body: JSON.stringify({ packageType: 'full_unlock' }) 
                        });
                        
                        const data = await res.json();
                        
                        if (res.ok && data.checkout_url) {
                            localStorage.setItem('pending_checkout_id', data.session_id);
                            window.location.href = data.checkout_url;
                        } else {
                            alert("Error: " + (data.message || "Could not create payment link."));
                            buyNowBtn.innerText = "Pay via GCash / Card";
                            buyNowBtn.disabled = false;
                        }
                    } catch (err) {
                        console.error(err);
                        alert("Network error.");
                        buyNowBtn.innerText = "Pay via GCash / Card";
                        buyNowBtn.disabled = false;
                    }
                });
            }

            async function checkPaymentStatus() {
                const urlParams = new URLSearchParams(window.location.search);
                const status = urlParams.get('status');

                if (status === 'success') {
                    window.history.replaceState({}, document.title, window.location.pathname);
                    showStatusModal("Verifying Payment", "Contacting PayMongo...", false);

                    const sessionId = localStorage.getItem('pending_checkout_id');
                    if (!sessionId) {
                        showStatusModal("Error", "Session ID missing.", false, true);
                        return;
                    }

                    try {
                        const res = await fetch(`/api/payment/verify-status?cs_id=${sessionId}`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        const data = await res.json();

                        if (data.status === 'paid') {
                            localStorage.removeItem('pending_checkout_id');
                            // Use Dynamic Message
                            const successMsg = data.message || "Transaction successful.";
                            showStatusModal("Payment Successful! ðŸŽ‰", successMsg, true);
                            setTimeout(() => { location.reload(); }, 2000);
                        } else {
                            showStatusModal("Payment Incomplete", "Status: " + data.status, false, true);
                        }
                    } catch (error) {
                        console.error(error);
                        showStatusModal("Error", "Could not verify payment.", false, true);
                    }
                } else if (status === 'cancelled') {
                    showStatusModal("Payment Cancelled", "Transaction was cancelled.", false, true);
                }

                // CHECK FOR BOOKING RETURN

                if (status === 'booking_success') {
                    const sessionId = localStorage.getItem('pending_booking_id');
                    if(sessionId) {
                        showStatusModal("Verifying Booking", "Please wait...", false);
                        
                        fetch(`/api/booking/verify?session_id=${sessionId}`, {
                            headers: { 'Authorization': `Bearer ${token}` }
                        })
                        .then(res => res.json())
                        .then(data => {
                            if(data.status === 'paid') {
                                localStorage.removeItem('pending_booking_id');
                                showStatusModal("Booking Confirmed! ðŸš™", "See you at the dunes!", true);
                                // Optionally redirect to a "My Bookings" tab
                            } else {
                                showStatusModal("Error", "Payment not completed.", false, true);
                            }
                        });
                    }
                }
            }


            // ---------------------------------------------------------
            // 6. INITIALIZATION
            // ---------------------------------------------------------
            loadGallery();
            loadUserProfile();
            checkPaymentStatus();
        </script>

      </div>



    <div id="account" class="tab-content">
      <div class="content-card">
          <h2 class="section-title">Personal Information</h2>
          
          <form id="profileForm">
              <div class="form-grid">
                  <div class="form-group">
                      <label>First Name</label>
                      <input type="text" id="firstNameInput" placeholder="Loading...">
                  </div>
                  <div class="form-group">
                      <label>Last Name</label>
                      <input type="text" id="lastNameInput" placeholder="Loading...">
                  </div>
                  <div class="form-group">
                      <label>Email Address</label>
                      <input type="email" id="emailInput" disabled style="background: #f9f9f9; color: #777; cursor: not-allowed;">
                      <small style="color: #999; font-size: 11px;">Email cannot be changed</small>
                  </div>
                  <div class="form-group">
                      <label>Phone Number</label>
                      <input type="tel" id="phoneInput" placeholder="Add phone number">
                  </div>
              </div>

                <button type="button" id="saveProfileBtn" class="btn-primary" style="margin-top: 20px;">
                    Save Changes
                </button>
            </form>
        </div>
    </div>

    <div id="bookings" class="tab-content">
        <div class="content-card">
            <h2 class="section-title">My Bookings</h2>
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Booking Ref</th>
                        <th>Package</th>
                        <th>Location</th>
                        <th>Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>#BK-2025-001</td>
                        <td>Barkada Package A</td>
                        <td>San Juan, La Union</td>
                        <td>Dec 10, 2025</td>
                        <td><span class="status-badge status-pending">Upcoming</span></td>
                    </tr>
                    <tr>
                        <td>#BK-2024-892</td>
                        <td>Solo Portrait</td>
                        <td>Intramuros</td>
                        <td>Oct 15, 2024</td>
                        <td><span class="status-badge status-completed">Completed</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="transactions" class="tab-content">
        <div class="content-card">
            <h2 class="section-title">Transaction History</h2>
            <table class="custom-table">
                <thead>
                    <tr>
                        <th>Transaction ID</th>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>TRX-99812</td>
                        <td>Dec 01, 2025</td>
                        <td>Downpayment - La Union</td>
                        <td>â‚± 1,500.00</td>
                        <td><span class="status-badge status-completed">Paid</span></td>
                    </tr>
                    <tr>
                        <td>TRX-88123</td>
                        <td>Oct 10, 2024</td>
                        <td>Full Payment - Intramuros</td>
                        <td>â‚± 3,000.00</td>
                        <td><span class="status-badge status-completed">Paid</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

      <div id="security" class="tab-content">
          <div class="content-card" style="max-width: 600px;">
              <h2 class="section-title">Security Settings</h2>
              <form>
                  <div class="form-group">
                      <label>Current Password</label>
                      <input type="password" placeholder="Enter current password">
                  </div>
                  <div class="form-group">
                      <label>New Password</label>
                      <input type="password" placeholder="Enter new password">
                  </div>
                  <div class="form-group">
                      <label>Confirm New Password</label>
                      <input type="password" placeholder="Confirm new password">
                  </div>
                  <button class="btn-primary">Update Password</button>
              </form>
          </div>
        </div>
    </div>

    <div id="imageModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="modalImg">
        <div id="caption"></div>
    </div>

    <div id="imageModal" class="modal">
      <span class="close">&times;</span>
      <img class="modal-content" id="modalImg">
      <div id="caption"></div>
    </div>

   <!-- ===== FOOTER SECTION ===== -->
    <footer>
        <div class="footer-container">
            <!-- LEFT: Logo and Contact -->
            <div class="footer-logo-section">
                <div class="footer-logo">
                    <img src="images/logo_wbg.png" alt="ProfilePic Multimedia">
                </div>
                <div class="footer-contact">
                    <p>0976 004 2741</p>
                    <p>profilepicmultimedia@gmail.com</p>
                </div>
            </div>

            <!-- Navigation -->
              <div class="footer-column">
                  <h3>Discover</h3>
                  <ul>
                      <li><a href="about.html">About Us</a></li>
                      <li><a href="package.html#partner-locations">Partner Locations</a></li>
                      <li><a href="package.html">Packages</a></li>
                      <li><a href="gallery.html">Gallery</a></li>
                      <li><a href="index.html#ntestimonial">Testimonials</a></li>
                  </ul>
              </div>

              <div class="footer-column">
                  <h3>Support</h3>
                  <ul>
                      <li><a href="#">How It Works</a></li>
                      <li><a href="#">Booking Guide</a></li>
                      <li><a href="user/user_gallery.html">My Gallery</a></li>
                      <li><a href="#">Edit My Account</a></li>
                      <li><a href="privacy-policy.html">Payment & Refund Policy</a></li>
                      <li><a href="contact.html">Contact</a></li>
                  </ul>
              </div>

              <!-- Legal -->
              <div class="footer-column">
                  <h3>Legal</h3>
                  <ul>
                      <li><a href="#">Terms & Conditions</a></li>
                      <li><a href="privacy-policy.html">Privacy Policy</a></li>
                      <li><a href="#">FAQs</a></li>
                  </ul>
              </div>

            <!-- Follow Us -->
            <div class="footer-column">
                <h3>Follow us</h3>
                <ul>
                <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M240 363.3L240 576L356 576L356 363.3L442.5 363.3L460.5 265.5L356 265.5L356 230.9C356 179.2 376.3 159.4 428.7 159.4C445 159.4 458.1 159.8 465.7 160.6L465.7 71.9C451.4 68 416.4 64 396.2 64C289.3 64 240 114.5 240 223.4L240 265.5L174 265.5L174 363.3L240 363.3z"/></svg></a>
                <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M544.5 273.9C500.5 274 457.5 260.3 421.7 234.7L421.7 413.4C421.7 446.5 411.6 478.8 392.7 506C373.8 533.2 347.1 554 316.1 565.6C285.1 577.2 251.3 579.1 219.2 570.9C187.1 562.7 158.3 545 136.5 520.1C114.7 495.2 101.2 464.1 97.5 431.2C93.8 398.3 100.4 365.1 116.1 336C131.8 306.9 156.1 283.3 185.7 268.3C215.3 253.3 248.6 247.8 281.4 252.3L281.4 342.2C266.4 337.5 250.3 337.6 235.4 342.6C220.5 347.6 207.5 357.2 198.4 369.9C189.3 382.6 184.4 398 184.5 413.8C184.6 429.6 189.7 444.8 199 457.5C208.3 470.2 221.4 479.6 236.4 484.4C251.4 489.2 267.5 489.2 282.4 484.3C297.3 479.4 310.4 469.9 319.6 457.2C328.8 444.5 333.8 429.1 333.8 413.4L333.8 64L421.8 64C421.7 71.4 422.4 78.9 423.7 86.2C426.8 102.5 433.1 118.1 442.4 131.9C451.7 145.7 463.7 157.5 477.6 166.5C497.5 179.6 520.8 186.6 544.6 186.6L544.6 274z"/></svg></a>
                </ul>
            </div>
            
        </div>

        <div class="footer-bottom">
            <p class="copyright">Copyright Â© ProfilePicMultimedia 2025</p>
            <a href="#" class="back-to-top">Back to top</a>
        </div>
    </footer>

  <script>
      function openTab(evt, tabName) {
          // Hide all tab content
          var i, tabContent, tabBtns;
          tabContent = document.getElementsByClassName("tab-content");
          for (i = 0; i < tabContent.length; i++) {
              tabContent[i].classList.remove("active");
          }

          // Remove active class from all buttons
          tabBtns = document.getElementsByClassName("tab-btn");
          for (i = 0; i < tabBtns.length; i++) {
              tabBtns[i].classList.remove("active");
          }

          // Show the current tab and add active class to button
          document.getElementById(tabName).classList.add("active");
          evt.currentTarget.classList.add("active");
      }


document.addEventListener("DOMContentLoaded", async () => {
    // ==========================================
    // PART 1: NAVBAR & LOGOUT LOGIC
    // ==========================================
    const accountNav = document.getElementById("account-nav");
    const token = localStorage.getItem("token"); // token stored after login

    if (accountNav) {
        if (token) {
            // User is logged in
            accountNav.innerHTML = `
                <a href="user/user_gallery.html"><i class="fa-solid fa-user"></i> Profile</a>
                <a href="#" id="logout-btn" style="margin-left:10px; color:#ff4d4d;">Logout</a>
            `;

            // Logout functionality
            const logoutBtn = document.getElementById("logout-btn");
            if (logoutBtn) {
                logoutBtn.addEventListener("click", (e) => {
                    e.preventDefault();
                    localStorage.removeItem("token");
                    window.location.reload();
                });
            }
        } else {
            // User not logged in
            accountNav.innerHTML = `
                <a href="login.html">Login</a> /
                <a href="signup.html">Signup</a>
            `;
        }
    }

    // ==========================================
    // PART 2: PROFILE FORM LOGIC
    // ==========================================
    
    // 1. SELECT ELEMENTS
    const firstNameInput = document.getElementById('firstNameInput');
    const lastNameInput = document.getElementById('lastNameInput');
    const emailInput = document.getElementById('emailInput');
    const phoneInput = document.getElementById('phoneInput');
    const saveBtn = document.getElementById('saveProfileBtn');

    // 2. FETCH DATA (Only if we are on the profile page)
    if (firstNameInput) { 
        try {
            // Get the token from storage
            const token = localStorage.getItem('token');

            // Send it to the server
            const response = await fetch('/api/user-profile', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`, // specific format for tokens
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                const userData = await response.json();
                firstNameInput.value = userData.firstName || '';
                lastNameInput.value = userData.lastName || '';
                emailInput.value = userData.email || '';
                phoneInput.value = userData.phone || '';
            } else {
                console.warn('User profile fetch failed:', response.status);
            }
        } catch (error) {
            console.error('Error loading profile:', error);
        }
    }

    // 3. SAVE DATA
    if (saveBtn) {
        saveBtn.addEventListener('click', async () => {
            const originalText = saveBtn.innerText;
            saveBtn.innerText = 'Saving...';
            saveBtn.disabled = true;

            const updatedData = {
                firstName: firstNameInput.value,
                lastName: lastNameInput.value,
                phone: phoneInput.value
            };

            try {
                const response = await fetch('/api/update-profile', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updatedData)
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Profile updated successfully!');
                } else {
                    alert('Error: ' + (result.message || 'Update failed'));
                }

            } catch (error) {
                console.error('Error saving profile:', error);
                alert('Connection error. Please try again.');
            } finally {
                saveBtn.innerText = originalText;
                saveBtn.disabled = false;
            }
        });
    }
});
</script>

</body>
</html>